<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.25.0/babel.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

<script type="text/babel">
    //main class ggoes here
    class Main extends React.Component {
        constructor(){
            super()
            this.state = {
                grid: {row: 7, col: 10},
            }
        }
        
        render(){
            let cols = Array(this.state.grid.col).fill(false)
            let arr = Array(this.state.grid.row).fill(cols)
            console.log(arr)
            return (
                <div>
                    <Grid cells={arr}/>
                    <Foot/>
                </div>
            )
        }
    }
    class Grid extends React.Component{
        constructor(props){
            super(props)
            this.state = {
                cellStatus: this.props.cells
            }
            this.handleClick = this.handleClick.bind(this)
        }
        handleClick(e){
            let id = e.target.id
            let newArr = this.state.cellStatus.slice()
            console.log(id)
            let i = id.slice(0, 1)
            let j = id.slice(1)
            console.log(i, j)
            console.log(newArr[i])
            newArr[i][j] = !newArr[i][j]
            this.setState({cellStatus: newArr})
        }
        run(){
            let currentAllStat = this.state.cellStatus
            let newAllStat = []
            for (let i in currentAllStat){
                for (let j in currentAllStat[i]) {
                    let numOfNeighbors = 0
                    //console.log(currentAllStat[i][j])
                    if (currentAllStat[i][j + 1]) {numOfNeighbors++}
                    if (currentAllStat[i][j-1]) {numOfNeighbors++}
                    if (currentAllStat[i-1 < 0 ? i = currentAllStat.length -1: i-=1][j]) {numOfNeighbors++}
                    if (currentAllStat[i+1][j]) {numOfNeighbors++}
                    if (currentAllStat[i+1][j+1]) {numOfNeighbors++}
                    if (currentAllStat[i+1][j-1]) {numOfNeighbors++}
                    if (currentAllStat[i-1][j-1]) {numOfNeighbors++}
                    if (currentAllStat[i-1][j+1]) {numOfNeighbors++}

                    if (currentAllStat[i][j] == false && numOfNeighbors == 3) {
                    newAllStat.push(true)
                    }else if (newAllStat[i] == true && numOfNeighbors == 3){
                        newAllStat.push(true)
                    } else if (newAllStat[i] == true && numOfNeighbors == 2){
                        newAllStat.push(true)
                    }else {
                        newAllStat.push(false)
                    }
                }
            }
            this.setState({cellStatus: newAllStat})
        }
      
        render(){
            let arr = []
            for (let i in this.props.cells){
                arr.push([])
                for (let j in this.props.cells[i]){
                    arr[i].push(<Cell id={i+j} key={i+j} status={this.state.cellStatus[i][j]} onClick={this.handleClick}/>)
                }
            }
            console.log(arr)
            return (
                <div>
                    <Head run={this.run.bind(this)}/>
                    <div className='grid' style={{width: this.props.cells[0].length*20, height: this.props.cells.length*20}}>
                        {arr}
                    </div>
                </div>
            )
        }
    }
    class Cell extends React.Component{
        constructor(props){
            super(props)
            this.changeColor = this.changeColor.bind(this)
        }
        changeColor(e){
            let id = e.target.id
            //console.log(id)
            this.props.onClick(id)
            
        }
        render(){
            return (
                <button id={this.props.id} className={this.props.status ? 'cell-active':'cell'} onClick={this.props.onClick}></button>
            )
        }
    }
    class Head extends React.Component {
        render(){
            return (
                <div>
                    <button onClick={this.props.run} className='btn btn-primary'>Run</button>
                    <button className='btn btn-primary'>Pause</button>
                    <button className='btn btn-primary'>Clear</button>
                    <span>Generations</span>
                </div>
            )
        }
    }

    class Foot extends React.Component {
        render(){
            return (
                <p>some settings</p>
            )
        }
    }
    ReactDOM.render(<Main/>, document.querySelector('#app'))
    

</script>

<style>
    body{
        background: slategray;
        color: whitesmoke;
    }
    .container{
        margin-top: 40px;
        display: flex;
        justify-content: center;
        text-align: center;
    }
    .grid{
        display: flex;
        flex-wrap: wrap;
        border: 5px solid green;
        box-sizing: content-box;
        justify-content: flex-start;
    }
   .cell{
       width: 20px;
       height: 20px;
       background: #777;
       box-sizing: border-box;
       border: 1px solid #bbb;
   }
   .cell-active{
       width: 20px;
       height: 20px;
       background: white;
       box-sizing: border-box;
       border: 1px solid #bbb;
   }
  
</style>

<div id='app' class="container"></div>